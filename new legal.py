this is the query for the accident table 

With rank_unique_accident AS
(
  Select
    *,
    row_number() over(PARTITION BY acc_no ORDER BY active_dt Desc) rank_unique_accident
  from hub_pimsctp_accident
),
rank_unique_claims AS
(
  SELECT
    *,
    row_number() over(PARTITION BY clm_no ORDER BY active_dt Desc) rank_unique_claims
  FROM hub_pimsctp_claims
)
SELECT
  acc.acc_no,
  acc_null_flg,
  acc_nulled_dt,
  acc_nulled_rs,
  acc_circum,
  acc_dt,
  acc_loc,
  acc_blameless_flg,
  acc_postcd,
  acc_profile,
  acc_st_nm,
  acc_st_nm_type,
  acc_st_type_cd,
  acc_suburb,
  acc_coord_geo,
  acc_tm,
  acc_yr,
  acc_yr_grp_fnl_tgt,
  acc_created_ts,
  acc_entrd_dt,
  acc_mth,
  acc_rcvd_dt,
  acc_ads_involv,
  acc_nsw,
  acc_police_rpt_unavail,
  acc_rptd_police_dt,
  acc_state,
  DATEDIFF(current_date(), Cast(acc_dt AS DATE)) AS acc_dev_day,
  FLOOR(MONTHS_BETWEEN(CURRENT_DATE(), CAST(acc_dt AS DATE))) AS acc_dev_mth,
  FLOOR(MONTHS_BETWEEN(CURRENT_DATE(), CAST(acc_dt AS DATE)) / 3) AS acc_dev_qtr,
  acc_mnging_insur_cd,
  acc_police_attnd_scene,
  acc_police_rpt_no,
  Count(*) AS acc_cnt_of_clms
FROM rank_unique_accident acc
LEFT JOIN rank_unique_claims clm
  ON(acc.acc_no = clm.acc_no
  AND rank_unique_claims = 1)
Where rank_unique_accident = 1
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33;


and they have the dictionary file as to read the data frames :
{
  "HUB_PIMSCTP_ACCIDENT": {
    "sel_fields": "acc_no,acc_null_flg,acc_nulled_dt,acc_nulled_rs,acc_circum,acc_dt,acc_loc,acc_blameless_flg,acc_postcd,acc_profile,acc_st_nm,acc_st_nm_type,acc_st_type_cd,acc_suburb,acc_coord_geo,acc_tm,acc_yr,acc_yr_grp_fnl_tgt,acc_created_ts,acc_entrd_dt,acc_mth,acc_rcvd_dt,acc_ads_involv,acc_nsw,acc_police_rpt_unavail,acc_rptd_police_dt,acc_state,acc_mnging_insur_cd,acc_police_attnd_scene,acc_police_rpt_no,active_dt,active_ym,load_dt,source_system_cd",
    "key_columns": "acc_no",
    "orderby_columns": "active_dt",
    "enddate_deriving_column": "active_dt",
    "delta_column": "hub_insert_ts",
    "partition_columns": "source_system_cd,active_ym"
  },
  "HUB_PIMSCTP_CLAIMS": {
    "sel_fields": "clm_no,acc_no,active_dt"
    
  }
}
I will send you one query help me in creating the dictionary 
and for legal I have the below query                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         rank_unique_legal AS
(
    Select
        *,
        row_number() over(partition by clm_no, legl_aCode, legl_rank_first Order by active_dt Desc) AS rank_unique_legal,
        dense_rank() over(partition by clm_no, legl_aCode order by legl_rank_first desc) AS legl_rank_latest_latest
    From hub_pimsctp_legal
    Where legl_aCode IN('01','02')
),
rank_unique_claims AS
(
    Select
        *,
        row_number() over(partition by clm_no Order by active_dt Desc) AS rank_unique_claims
    From hub_pimsctp_claims
),
rank_unique_contact AS
(
    Select
        *,
        row_number() over(partition by con_id,con_type Order by active_dt Desc) AS rank_unique_contact
    From hub_pimsctp_contact
    Where con_type = 'ClaimLink'
),
legal_plaintaiff_change AS
(
    Select
        clm_no
    From rank_unique_legal
    Where legl_aCode = '02' and rank_unique_legal = 1
    Group by clm_no
    Having count(*) > 1
),
legal_plaintaiff_current_month AS
(
    Select Distinct
        clm_no
    From rank_unique_legal
    Where legl_aCode = '02' and rank_unique_legal = 1
    AND legl_rep_date >= DATEFROMPARTS(YEAR(GETDATE()), MONTH(GETDATE()), 1)
    AND legl_rep_date <= GETDATE()
),
legal_plaintaiff_change_current_month AS
(
    Select-- Distinct
        pc.clm_no
    From legal_plaintaiff_change pc
    Inner Join legal_plaintaiff_current_month pcm
    ON(pc.clm_no = pcm.clm_no)
),
unique_legal_first_and_latest AS
(
    Select
        clm_no,
        legl_consultatn_dt,
        legl_defendnt_counsel,
        legl_plntif_counsel,
        legl_defendnt_refrl_type,
        MAX(CASE WHEN legl_aCode = '01' AND legl_rank_latest_latest = 1 THEN legl_rep_date END) AS legl_defendnt_dt,
        MAX(CASE WHEN legl_aCode = '01' AND legl_rank_latest_latest = 1 THEN legl_Contact_Id END) AS legl_defendnt_Contact_Id,
        MAX(CASE WHEN legl_aCode = '02' AND legl_rank_latest_latest = 1 THEN legl_rep_date END) AS legl_plntif_reprstd_dt,
        MAX(CASE WHEN legl_aCode = '02' AND legl_rank_latest_latest = 1 THEN legl_Contact_Id END) AS legl_plntif_Contact_Id,
        MAX(CASE WHEN legl_aCode = '01' AND legl_rank_first = 1 THEN legl_rep_date END) AS legl_first_defendnt_rep_dt,
        MAX(CASE WHEN legl_aCode = '02' AND legl_rank_first = 1 THEN legl_rep_date END) AS legl_first_plntif_reprstd_dt,
        CASE WHEN SUM(CASE WHEN legl_aCode = '01' THEN 1 ELSE 0 END) > 0 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS legl_defendnt_rep_flg,
        CASE WHEN SUM(CASE WHEN legl_aCode = '02' THEN 1 ELSE 0 END) > 0 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS legl_plntif_reprstd_flg
    from rank_unique_legal Where rank_unique_legal = 1
    Group by clm_no, legl_consultatn_dt, legl_defendnt_counsel, legl_plntif_counsel, legl_defendnt_refrl_type
)
Select
    unique_legal_first_and_latest.clm_no,
    legl_consultatn_dt,
    legl_defendnt_counsel,
    legl_plntif_counsel,
    legl_defendnt_refrl_type,
    legl_defendnt_rep_flg,
    legl_defendnt_dt,
    legl_defendnt_Contact_Id,--We can ignore this into mart table
    legl_plntif_reprstd_flg,
    legl_plntif_reprstd_dt,
    legl_plntif_Contact_Id,--We can ignore this into mart table
    legl_first_defendnt_rep_dt,
    legl_first_plntif_reprstd_dt,
    CASE WHEN pccm.clm_no IS NOT NULL THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS legl_plntif_swtchd_mtd_ind,
    CASE WHEN legl_first_plntif_reprstd_dt <= clm_rpted_dt THEN CAST(1 AS BIT) ELSE CAST(1 AS BIT) END as legl_plntif_rep_at_lodgmnt_ind,
    plain_contact.con_first_nm AS con_plntif_legl_reprsntatve_first_nm,
    plain_contact.con_surname AS con_plntif_legl_reprsntatve_surname,
    plain_contact.con_home_email AS con_plntif_legl_email_addr,
    concat(plain_contact.con_home_ph_area_cd, plain_contact.con_home_ph_no) AS con_plntif_legl_ph_no,
    def_contact.con_abn AS legl_defendnt_abn,
    def_contact.con_firm AS legl_defendnt_firm,
    def_contact.con_phy_addr_PostCode AS con_defendnt_con_postcd,
    plain_contact.con_abn AS con_plntif_legl_abn,
    plain_contact.con_firm AS con_plntif_legl_firm,
    plain_contact.con_phy_addr_PostCode AS con_plntif_legl_phy_postcd,
    plain_contact.con_post_addr_PostCode AS con_plntif_legl_postcd,
    CASE WHEN plain_contact.con_classification = 'Individual' THEN concat(plain_contact.con_title, plain_contact.con_first_nm, plain_contact.con_surname)
        WHEN plain_contact.con_classification = 'Organisation' THEN plain_contact.con_org_nm END AS con_plntif_legl_reprsntatve_nm,
    plain_contact.con_brch AS con_plntif_legl_brch,
    concat(
        coalesce(plain_contact.con_phy_addr_line_1 + ',',''),
        coalesce(plain_contact.con_phy_addr_line_2 + ',',''),
        coalesce(plain_contact.con_phy_addr_Name + ',',''),
        coalesce(plain_contact.con_phy_addr_propertyName + ',',''),
        coalesce(plain_contact.con_phy_addr_unitNumber + ',',''),
        coalesce(plain_contact.con_phy_addr_LevelNo + ',',''),
        coalesce(plain_contact.con_phy_addr_StreetNumber + ',',''),
        coalesce(plain_contact.con_phy_addr_StreetName + ',',''),
        coalesce(plain_contact.con_phy_addr_StreetType + ',',''),
        coalesce(plain_contact.con_phy_addr_SuburbName + ',',''),
        coalesce(plain_contact.con_phy_addr_StateName + ',',''),
        coalesce(plain_contact.con_phy_addr_StateCode,'')) AS con_plntif_legl_phy_addr
From unique_legal_first_and_latest
Left Join legal_plaintaiff_change_current_month pccm
    ON(unique_legal_first_and_latest.clm_no = pccm.clm_no)
Left Join rank_unique_claims--Please note this can be used as Inner Join, we have taken as Left due to above dummy data
    ON(unique_legal_first_and_latest.clm_no = rank_unique_claims.clm_no
    AND rank_unique_claims = 1)
Left Join rank_unique_contact def_contact--this is dummy data
    ON(legl_defendnt_Contact_Id = def_contact.con_id
    AND def_contact.rank_unique_contact = 1)
Left Join rank_unique_contact plain_contact--this is dummy data
    ON(legl_defendnt_Contact_Id = plain_contact.con_id
    AND plain_contact.rank_unique_contact = 1)

help me in reating the dictionary file for the legal based on the query 





new yam l file 
MRT_PIMSCTP_VEHICLE:
  DEV:
    SOURCE_DB: 'd_gi_hub_ctp'
    SOURCE_TBL: hub_pimsctp_vehicle
    TARGET_DB: 'd_gi_mrt_ctp'
    TARGET_TBL: 'mrt_pimsctp_vehicle'
    TARGET_DB_PATH : '/data/dev/gi/analytics/ctp/mart/d_gi_mrt_ctp'
    CONFIG_DIC_FILE_NAME: 'mrt_pimsctp_vehicle.dic'
    TARGET: 'acc_no,veh_no,pol_no,veh_make,veh_model,veh_yr,veh_cd,veh_vin_chassis_no,veh_engine_no,veh_body_type,veh_rego_no,veh_rego_state,veh_rego_valid_frm,veh_rego_valid_to,veh_rego_cancld,veh_insurd_by_allianz,veh_unident,veh_uninsurd,veh_insurd_ind,veh_ctp_insur_cd,veh_insur_prem_cls,veh_insurd_oth,veh_ctp_insur,veh_liab_pct,veh_pol_itc_entitl,veh_type,veh_garag_postcd,veh_dit_unique_iden,veh_oth_factors,veh_ownshp_type,veh_property_insur,veh_repairer_icf,veh_vdeo_photgrphic_evidnce_icf,begin_dt,end_dt,hub_insert_ts,active_dt,active_ym,load_dt,source_system_cd'

MRT_PIMSCTP_ACCIDENT:
  DEV:
    SOURCE_DB: 'd_gi_hub_ctp'
    SOURCE_TBL: hub_pimsctp_accident
    TARGET_DB: 'd_gi_mrt_ctp'
    TARGET_TBL: 'mrt_pimsctp_accident'
    TARGET_DB_PATH : '/data/dev/gi/analytics/ctp/mart/d_gi_mrt_ctp'
    CONFIG_DIC_FILE_NAME: 'mrt_pimsctp_accident.dic'
    TARGET: 'acc_no,acc_circum,acc_dt,acc_loc,acc_coord_geo,acc_created_ts,acc_blameless_flg,acc_postcd,acc_profile,acc_st_nm,acc_st_nm_type,acc_st_type_cd,acc_suburb,acc_tm,acc_yr,acc_yr_grp_fnl_tgt,acc_null_flg,acc_nulled_dt,acc_nulled_rs,acc_entrd_dt,acc_mth,acc_rcvd_dt,acc_ads_involv,acc_nsw,acc_cnt_of_clms,acc_police_rpt_unavail,acc_rptd_police_dt,acc_state,acc_dev_day,acc_dev_mth,acc_dev_qtr,acc_mnging_insur_cd,acc_police_attnd_scene,acc_police_rpt_no,hub_insert_ts,end_dt,begin_dt,active_dt,active_ym,load_dt,source_system_cd'

MRT_PIMSCTP_TREATMENT:
  DEV:
    SOURCE_DB: 'd_gi_hub_ctp'
    SOURCE_TBL: hub_pimsctp_treatment
    TARGET_DB: 'd_gi_mrt_ctp'
    TARGET_TBL: 'mrt_pimsctp_treatment'
    TARGET_DB_PATH : '/data/dev/gi/analytics/ctp/mart/d_gi_mrt_ctp'
    CONFIG_DIC_FILE_NAME: 'mrt_pimsctp_treatment.dic'
    TARGET: 'trtmt_no,clm_no,trtmt_first_plan_intiated_by,trtmt_no_of_sess_apprvd,trtmt_no_of_sess_reqstd,trtmt_care_completed,trtmt_care_respnse,trtmt_care_servc_provider,trtmt_care_servc_type,trtmt_care_advised_dt,trtmt_care_reqstd_dt,trtmt_manager,begin_dt,end_dt,hub_insert_ts,active_dt,active_ym,load_dt,source'

MRT_PIMSCTP_INJURY_CODING:
  DEV:
    SOURCE_DB: 'd_gi_hub_ctp'
    SOURCE_TBL: hub_pimsctp_injury_coding
    TARGET_DB: 'd_gi_mrt_ctp'
    TARGET_TBL: 'mrt_pimsctp_injury_coding'
    TARGET_DB_PATH: '/data/dev/gi/analytics/ctp/mart/d_gi_mrt_ctp'
    CONFIG_DIC_FILE_NAME: 'mrt_pimsctp_injury_coding.dic'
    TARGET: 'clm_no,injc_rcd_no,injc_cd,injc_severity,injc_insuff_med_info_flg,injc_potential_lss_cds,injc_psych_cd_flg,injc_added_dt,injc_cd_set,injc_cd_added_by,injc_cd_desc,begin_dt,end_dt,hub_insert_ts,active_dt,active_ym,load_dt,source_system_cd'
MRT_PIMSCTP_INJURY_DETAILS:
  DEV:
    SOURCE_DB: 'd_gi_hub_ctp'
    SOURCE_TBL: hub_pimsctp_injury_details
    TARGET_DB: 'd_gi_mrt_ctp'
    TARGET_TBL: 'mrt_pimsctp_injury_details'
    TARGET_DB_PATH: '/data/dev/gi/analytics/ctp/mart/d_gi_mrt_ctp'
    CONFIG_DIC_FILE_NAME: 'mrt_pimsctp_injury_details.dic'
    TARGET: 'injd_rcd_no,clm_no,injd_domint_item_no,injd_psych_fact_ind,injd_cd_all,injd_severity_ind,injd_desc_all,injd_psych_only_clm,injd_cd_stat,injd_cd_last_revwd_dt,injd_ambulance_reqrd,injd_are_consitnt_with_acc_det_mc,injd_nervous_shock_flg,injd_nsiiq_pcpt,injd_comp_to_relatives,injd_phyly_examined,injd_domint_scale_value,injd_examination_dt,injd_excep_harsh_unjust_provsn,injd_expectd_trtmt_period,injd_expectd_trtmt_period_icf,injd_gepic_rpt_flg,injd_hosp_admsn_dt,injd_hosp_attndce,injd_hosp_discharge_dt,injd_hospsd_over_24hrs,injd_whiplash_navigtr,injd_scale_uplift_cd,injd_scale_uplift_value,injd_scale_value,injd_concrnt_subseq_clm,injd_is_clmnt_existng_patient_of_dr_mc,injd_depdncy_clm_type,injd_lifetime_supprt_auth,injd_lifetime_supprt_auth_dt,injd_med_cert_general_practitnr_nm,injd_med_practitnr_ahpra_no,injd_multiple_ind,injd_nmof_med_prac_hosp_mc,injd_est_mais,injd_non_econ_loss_isv_variance_cd,injd_pcpt_fatlty_flg,injd_lifetime_supprt_auth_app_ref,injd_lifetime_supprt_auth_app_stat,injd_med_cert_signed_dt,injd_postcd_med_prac_hosp_mc,injd_prior_persnal_inj,injd_suitablty_for_duties_mc,injd_tot_scale_value,injd_trted_by_ambulance_icf,injd_trtmt_ind,begin_dt,end_dt,hub_insert_ts,active_dt,active_ym,load_dt,source_system_cd'

mart builder 


import sys
import json
import os

from pyspark.sql.functions import col, current_timestamp, max, expr, lit
from src.utils.df_utils import selective_df_mrt, save_hive_mrt, delete_path, move_partitions, add_end_date, \
    derive_lag_hierarchy, delete_hdfs_directory


def read_source_table(spark, props, json_obj, logger, source_col='source'):
    """
    This function reads data from source table using selective df util function and creates a dataframe
    :param source_col:
    :param spark: Spark instance variable
    :param props:
    :param json_obj: Dictionary object
    :param logger:
    :return:
    """
    logger.info(__name__, "Reading data from hub source table ::Started")
    source_db_table = props['SOURCE_DB'] + "." + props['SOURCE_TBL']
    source_filter = props['source_type']
    sel_columns = json_obj[props['SOURCE_TBL'].upper()]['sel_fields'].split(",")
    source_df = selective_df_mrt(spark, source_db_table, sel_columns)
    source_df = source_df.filter(col(source_col) == source_filter)

    if json_obj[props['SOURCE_TBL'].upper()].get('filter_condition') is not None:
        filter_con = json_obj[props['SOURCE_TBL'].upper()].get('filter_condition')
        source_df = source_df.filter(expr(filter_con))

    return source_df


def get_delta_records(target_df, source_df, props, json_obj, logger):
    """
    Retrieves the delta records from the source DataFrame based on the last inserted timestamp in the target DataFrame.

    Args:
        target_df (DataFrame): The target DataFrame where the delta records will be inserted.
        source_df (DataFrame): The source DataFrame containing all the records.
        props (dict): A dictionary containing SOURCE_TBL property.
        json_obj (dict): A dictionary containing the delta_column (e.g. 'hub_insert_ts'), and src_timestamp_column (default: 'load_dt') properties.
        logger (Logger): The logger object used for logging.

    Returns:
        DataFrame: The DataFrame containing the delta records.

    """
    logger.info(__name__, "")
    tbl_obj = json_obj[props['SOURCE_TBL'].upper()]
    delta_column = tbl_obj['delta_column']
    src_timestamp_column = tbl_obj.get("src_timestamp_column", "load_dt")
    last_inserted_ts = target_df.agg(max(col(delta_column))).collect()[0][0]    
    delta_df = source_df.filter(col(src_timestamp_column) > lit(last_inserted_ts))
    delta_df = delta_df.withColumnRenamed(src_timestamp_column, "hub_insert_ts")

    return delta_df


def write_data_to_temp_table(spark, props, df, partition_columns, logger):
    """
    Creates a temp table.

    Args:
        spark (SparkSession): The SparkSession object.
        props (dict): A dictionary containing the properties for the table.
        df (DataFrame): The DataFrame containing the data to be written.
        partition_columns (list): A list of partition columns for the table.
        logger (Logger): The logger object for logging.

    Returns:
        None
    """
    target_table = props['TARGET_TBL']
    temp_table = target_table + '_' + props['source_type'] + '_tmp'

    table_loc = os.path.join(props["TARGET_DB_PATH"], props['TARGET_TBL'] + '_' + props['source_type'] + "_tmp")

    delete_path(spark, table_loc)

    df = df.withColumn("load_dt", current_timestamp())
    sel_list = props['TARGET'].split(',')
    result_table = df.select(*sel_list)
    # Delete Temp path
    delete_hdfs_directory(table_loc)

    # Create temp table
    spark.sql("CREATE TABLE IF NOT EXISTS {tmp_table} LIKE {actual_table} LOCATION '{location}'"
              .format(tmp_table=props['TARGET_DB'] + '.' + temp_table,
                      actual_table=props['TARGET_DB'] + '.' + target_table,
                      location=table_loc))

    save_hive_mrt(spark=spark, df=result_table, columns_obj=props, hive_db_name=props['TARGET_DB'],
              hive_table_name=temp_table, mode="append_partition", partition_column=partition_columns,
              app_logger=logger)

    spark.sql("MSCK REPAIR TABLE {}".format(props['TARGET_DB'] + '.' + temp_table))


def save_data_to_target_table(spark, props, json_obj, df, logger, partition_columns):
    """

    :param spark:
    :param props:
    :param json_obj:
    :param df:
    :param logger:
    :param partition_columns:
    """
    logger.info(__name__, 'Inserting data to target table: Started')
    tbl_conf = json_obj[props['SOURCE_TBL'].upper()]
    src_timestamp_column = tbl_conf.get("src_timestamp_column", "load_dt")
    df = df.withColumnRenamed(src_timestamp_column, "hub_insert_ts")
    df = df.withColumn("load_dt", current_timestamp())
    sel_list = props['TARGET'].split(',')
    result_table = df.select(*sel_list)
    '''Prepare data to be inserted into the target table'''
    try:
        save_hive_mrt(spark=spark, df=result_table, columns_obj=props, hive_db_name=props['TARGET_DB'],
                  hive_table_name=props['TARGET_TBL'], mode="append_partition", partition_column=partition_columns,
                  app_logger=logger)
        spark.sql("refresh table " + props['TARGET_DB'] + "." + props['TARGET_TBL'])
        logger.info(__name__, "Data saved successfully")
    except ValueError as ve:
        logger.error(__name__, "Error Writing the data to table" + str(ve))
        sys.exit(1)


def mart_builder(spark, props, logger):
    """
    Main function for mart builder to load mart tables with Begin and End date fields
    :param spark: spark object
    :param props: properties
    :param logger: logger object
    """
    conf_file = props['CONFIG_DIC_FILE_NAME']

    # Read config dic file
    json_obj = json.load(open(str(conf_file), 'r'))
    print("json_obj:{}".format(json_obj))
    print("props:{}".format(props))

    target_df = spark.read.table(props['TARGET_DB'] + "." + props['TARGET_TBL'])
    source_table = props['SOURCE_TBL'].upper()
    source_filter = props['source_type'].upper()
    source_column = json_obj[source_table].get('source_column')
    if source_column is None:
        source_column = 'source'

    logger.info(__name__, "Source column name is {}".format(source_column))
    target_df = target_df.filter(col(source_column) == source_filter)
    key_columns = json_obj[source_table]['key_columns']
    orderby_columns = json_obj[source_table]['orderby_columns']
    partition_columns = json_obj[source_table]['partition_columns']
    enddate_deriving_column = json_obj[source_table]['enddate_deriving_column']

    source_df = read_source_table(spark, props, json_obj, logger, source_col=source_column)

    if len(target_df.head(1)) == 0:
        logger.info(__name__, "No records in target table for particualr source, Executing full load")

        # Adding end date to source dataframe
        final_df = add_end_date(source_df, key_columns, orderby_columns, enddate_deriving_column)

        save_data_to_target_table(spark, props, json_obj, final_df, logger, partition_columns)
    else:
        delta_df = get_delta_records(target_df, source_df, props, json_obj, logger)

        if len(delta_df.take(1)) == 0:
            logger.info(__name__, "No delta records to process")
        else:
            final_df = derive_lag_hierarchy(delta_df, target_df, key_columns, orderby_columns, enddate_deriving_column)

            write_data_to_temp_table(spark, props, final_df, partition_columns, logger)

            temp_table = props['TARGET_TBL'] + '_' + props['source_type'] + '_tmp'

            move_partitions(spark, temp_table, props['TARGET_TBL'], props['TARGET_DB'], props["TARGET_DB_PATH"])

            # Drop temp table
            spark.sql("DROP TABLE IF EXISTS {}".format(props['TARGET_DB'] + "." + temp_table))


mrt_accident 

import json
from pyspark.sql.functions import col, lit, when, rank, upper, date_format, to_date, date_sub, lag
from src.utils.df_utils import add_end_date,move_partitions
from src.modules.mart.mart_builder import read_source_table, get_delta_records,write_data_to_temp_table, save_data_to_target_table, derive_lag_hierarchy
from pyspark.sql.window import Window
from pyspark.sql import functions as F

def transform_data(df_accident, df_claim):

    # LEFT JOIN on acc_no
    joined = df_accident.alias("acc").join(
            df_claim.alias("clm"),
            (F.col("acc.acc_no") == F.col("clm.acc_no")),
            how="left"
    )

    # Derived development fields (using acc.acc_dt)
    joined = (
        joined
        .withColumn("acc_dev_day", F.datediff(F.current_date(), F.to_date(F.col("acc.acc_dt"))))
        .withColumn("acc_dev_mth", F.floor(F.months_between(F.current_date(), F.to_date(F.col("acc.acc_dt")))))
        .withColumn("acc_dev_qtr", F.floor(F.months_between(F.current_date(), F.to_date(F.col("acc.acc_dt"))) / F.lit(3)))
    )

    # Select the projected columns (renaming to match the SQL output)
    final_df = joined.select(
        F.col("acc.acc_no").alias("acc_no"),
        F.col("acc.acc_null_flg").alias("acc_null_flg"),
        F.col("acc.acc_nulled_dt").alias("acc_nulled_dt"),
        F.col("acc.acc_nulled_rs").alias("acc_nulled_rs"),
        F.col("acc.acc_circum").alias("acc_circum"),
        F.col("acc.acc_dt").alias("acc_dt"),
        F.col("acc.acc_loc").alias("acc_loc"),
        F.col("acc.acc_blameless_flg").alias("acc_blameless_flg"),
        F.col("acc.acc_postcd").alias("acc_postcd"),
        F.col("acc.acc_profile").alias("acc_profile"),
        F.col("acc.acc_st_nm").alias("acc_st_nm"),
        F.col("acc.acc_st_nm_type").alias("acc_st_nm_type"),
        F.col("acc.acc_st_type_cd").alias("acc_st_type_cd"),
        F.col("acc.acc_suburb").alias("acc_suburb"),
        F.col("acc.acc_coord_geo").alias("acc_coord_geo"),
        F.col("acc.acc_tm").alias("acc_tm"),
        F.col("acc.acc_yr").alias("acc_yr"),
        F.col("acc.acc_yr_grp_fnl_tgt").alias("acc_yr_grp_fnl_tgt"),
        F.col("acc.acc_created_ts").alias("acc_created_ts"),
        F.col("acc.acc_entrd_dt").alias("acc_entrd_dt"),
        F.col("acc.acc_mth").alias("acc_mth"),
        F.col("acc.acc_rcvd_dt").alias("acc_rcvd_dt"),
        F.col("acc.acc_ads_involv").alias("acc_ads_involv"),
        F.col("acc.acc_nsw").alias("acc_nsw"),
        F.col("acc.acc_police_rpt_unavail").alias("acc_police_rpt_unavail"),
        F.col("acc.acc_rptd_police_dt").alias("acc_rptd_police_dt"),
        F.col("acc.acc_state").alias("acc_state"),
        F.col("acc_dev_day"),
        F.col("acc_dev_mth"),
        F.col("acc_dev_qtr"),
        F.col("acc.acc_mnging_insur_cd").alias("acc_mnging_insur_cd"),
        F.col("acc.acc_police_attnd_scene").alias("acc_police_attnd_scene"),
        F.col("acc.acc_police_rpt_no").alias("acc_police_rpt_no"),
        F.col("acc.active_dt").alias("active_dt"),
        F.col("acc.active_ym").alias("active_ym"),
        F.col("acc.load_dt").alias("load_dt"),
        F.col("acc.source_system_cd").alias("source_system_cd")

        
    )

    # GROUP BY the first 33 selected columns and COUNT(*)
    result = (
        final_df.groupBy(
            "acc_no",
            "acc_null_flg",
            "acc_nulled_dt",
            "acc_nulled_rs",
            "acc_circum",
            "acc_dt",
            "acc_loc",
            "acc_blameless_flg",
            "acc_postcd",
            "acc_profile",
            "acc_st_nm",
            "acc_st_nm_type",
            "acc_st_type_cd",
            "acc_suburb",
            "acc_coord_geo",
            "acc_tm",
            "acc_yr",
            "acc_yr_grp_fnl_tgt",
            "acc_created_ts",
            "acc_entrd_dt",
            "acc_mth",
            "acc_rcvd_dt",
            "acc_ads_involv",
            "acc_nsw",
            "acc_police_rpt_unavail",
            "acc_rptd_police_dt",
            "acc_state",
            "acc_dev_day",
            "acc_dev_mth",
            "acc_dev_qtr",
            "acc_mnging_insur_cd",
            "acc_police_attnd_scene",
            "acc_police_rpt_no",
            "active_dt",
            "active_ym",
            "load_dt",
            "source_system_cd"
        )
        .agg(F.count("*").alias("acc_cnt_of_clms"))
    )

    return result


def mrt_accident(spark, props, logger):

    conf_file = props['CONFIG_DIC_FILE_NAME']

    # Read config dic file
    json_obj = json.load(open(str(conf_file), 'r'))
    logger.info(__name__, f"Config Dic File: {json_obj}")

    target_df = spark.read.table(props['TARGET_DB'] + "." + props['TARGET_TBL'])
    source_table = props['SOURCE_TBL'].upper()
    source_filter = props['source_type'].upper()
    source_column = json_obj[source_table].get('source_column')
    if source_column is None:
        source_column = 'source_system_cd'
    key_columns = json_obj[source_table]['key_columns']
    orderby_columns = json_obj[source_table]['orderby_columns']
    partition_columns = json_obj[source_table]['partition_columns']
    enddate_deriving_column = json_obj[source_table]['enddate_deriving_column']
    
    df_accident = read_source_table(spark, props, json_obj, logger, source_col = source_column)
    df_claim = read_source_table(spark, props, json_obj, logger, source_col = source_column)
    source_df = transform_data(df_accident, df_claim)

    partition_path = props["TARGET_DB_PATH"] + "/" + props['TARGET_TBL'] + "/source=()/'".format(source_filter)

    if len(target_df.head(1)) == 0:
        logger.info(__name__, "No records in target table for particualr source, Executing full load")

        # Adding end date to source dataframe
        final_df = add_end_date(source_df, key_columns, orderby_columns, enddate_deriving_column)

        save_data_to_target_table(spark, props, json_obj, final_df, logger, partition_columns)
    else:
        delta_df = get_delta_records(target_df, source_df, props, json_obj, logger)

        if len(delta_df.take(1)) == 0:
            logger.info(__name__, "No delta records to process")
        else:
            final_df = derive_lag_hierarchy(delta_df, target_df, key_columns, orderby_columns, enddate_deriving_column)

            write_data_to_temp_table(spark, props, final_df, partition_columns, logger)

            temp_table = props['TARGET_TBL'] + '_' + props['source_type'] + '_tmp'

            move_partitions(spark, temp_table, props['TARGET_TBL'], props['TARGET_DB'], props["TARGET_DB_PATH"])

            # Drop temp table
            spark.sql("DROP TABLE IF EXISTS {}".format(props['TARGET_DB'] + "." + temp_table))
